---
import type { MusicProject } from "../data/music";
import type { Locale } from "../i18n";
import { pick } from "../i18n";

const { project, locale, index = 0 } = Astro.props as {
  project: MusicProject;
  locale: Locale;
  index?: number;
};

const staggerClass = `stagger-${Math.min(index + 1, 6)}`;

// Platform icons (simple SVG paths)
const platformIcons: Record<string, string> = {
  website: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z",
  spotify: "M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z",
  deezer: "M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm4.873 16.118H7.127v-1.274h9.746v1.274zm0-2.548H7.127V12.3h9.746v1.27zm0-2.544H7.127V9.752h9.746v1.274zm0-2.548H7.127V7.204h9.746v1.274z",
  appleMusic: "M23.994 6.124c0-.815-.05-1.63-.15-2.437-.101-.807-.253-1.604-.456-2.39A8.97 8.97 0 0 0 22.16.276 8.86 8.86 0 0 0 21.14.073C20.324.025 19.508 0 18.693 0H5.307C4.492 0 3.676.025 2.86.073A8.86 8.86 0 0 0 1.84.276 8.97 8.97 0 0 0 .612 1.297c-.203.786-.355 1.583-.456 2.39-.1.807-.15 1.622-.15 2.437v11.752c0 .815.05 1.63.15 2.437.101.807.253 1.604.456 2.39a8.97 8.97 0 0 0 1.228 1.021 8.86 8.86 0 0 0 1.02.203c.816.048 1.632.073 2.447.073h13.386c.815 0 1.631-.025 2.447-.073.344-.05.686-.12 1.02-.203a8.97 8.97 0 0 0 1.228-1.021c.203-.786.355-1.583.456-2.39.1-.807.15-1.622.15-2.437V6.124zM17.293 18.41c0 .61-.497 1.105-1.107 1.105-.61 0-1.107-.496-1.107-1.105V9.166c0-.263-.095-.46-.287-.59a1.077 1.077 0 0 0-.63-.138l-5.487.807c-.273.04-.508.153-.704.34-.196.186-.294.423-.294.71v6.843c0 .61-.497 1.105-1.107 1.105-.61 0-1.107-.496-1.107-1.105V8.693c0-.625.227-1.175.682-1.65.454-.475 1.004-.752 1.65-.832l5.486-.806c.695-.102 1.324.063 1.886.495.562.432.843 1.002.843 1.71v10.8h-.717z",
  bandcamp: "M0 18.75l7.437-13.5H24l-7.438 13.5H0z",
  soundcloud: "M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.052-.1-.084-.1zm-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.201-1.308-.196-1.332c-.01-.057-.054-.094-.09-.094zm1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.059-.104-.12-.104zm.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.544-.225-2.64c-.015-.075-.06-.135-.135-.135l-.031-.001zm.96-.344c-.09 0-.165.075-.18.165l-.18 2.88.195 2.625c.015.09.075.164.165.164s.165-.074.18-.164l.21-2.625-.225-2.88c-.015-.09-.075-.165-.165-.165zm1.005-.182c-.105 0-.18.09-.195.195l-.165 2.865.18 2.685c.015.104.09.194.195.194.104 0 .179-.09.194-.194l.195-2.685-.21-2.865c-.015-.105-.075-.195-.18-.195h-.014zm1.049-.18c-.12 0-.209.105-.224.225l-.15 2.79.165 2.73c.015.12.09.224.21.224s.21-.105.225-.224l.18-2.73-.165-2.79c-.015-.12-.105-.225-.225-.225h-.016zm1.095-.135c-.135 0-.239.119-.254.254l-.135 2.67.15 2.76c.015.135.104.254.24.254.134 0 .239-.12.254-.255l.165-2.759-.15-2.67c-.015-.135-.12-.254-.255-.254h-.015zm1.109-.113c-.15 0-.269.135-.284.285l-.12 2.528.135 2.79c.015.15.12.285.27.285.149 0 .27-.135.284-.285l.15-2.79-.135-2.528c-.015-.15-.135-.285-.285-.285h-.015zm1.125-.03c-.165 0-.3.15-.314.315l-.105 2.31.12 2.82c.015.165.135.315.3.315.164 0 .299-.15.314-.315l.135-2.82-.12-2.31c-.015-.165-.15-.315-.315-.315h-.015zm1.096.18c-.18 0-.315.165-.315.345l-.09 2.085.105 2.835c0 .18.135.345.315.345.179 0 .314-.165.329-.345l.12-2.835-.105-2.085c-.015-.18-.165-.345-.345-.345h-.014zm1.155-.345c-.195 0-.344.18-.359.375l-.09 2.385.105 2.835c.015.195.165.375.36.375.179 0 .344-.18.359-.375l.119-2.835-.104-2.385c-.015-.195-.18-.375-.375-.375h-.015zm1.155-.345c-.21 0-.375.195-.39.405l-.075 2.685.09 2.82c.015.21.165.405.375.405.21 0 .375-.195.39-.405l.105-2.82-.09-2.685c-.015-.21-.18-.405-.39-.405h-.015zm1.154-.345c-.225 0-.39.21-.405.435l-.06 2.985.075 2.82c.015.225.18.435.405.435.225 0 .39-.21.42-.435l.09-2.82-.075-2.985c-.015-.225-.195-.435-.42-.435h-.03zm1.11-.135c-.24 0-.42.225-.435.465l-.045 3.075.06 2.79c.015.24.195.465.435.465s.42-.225.435-.465l.075-2.79-.06-3.075c-.015-.24-.21-.465-.45-.465h-.015zm1.17-.12c-.255 0-.45.24-.465.495l-.03 3.15.045 2.775c.015.255.21.495.465.495.254 0 .449-.24.464-.495l.06-2.775-.045-3.15c-.015-.255-.225-.495-.48-.495h-.014zm1.185-.045c-.27 0-.48.255-.495.525l-.015 3.15.03 2.76c.015.27.225.525.495.525.27 0 .48-.255.494-.525l.046-2.76-.03-3.15c-.015-.27-.24-.525-.51-.525h-.015zm3.481-.255c-.12-.075-.255-.12-.405-.12-.645 0-1.155.51-1.155 1.155v6.12c0 .63.495 1.14 1.11 1.155h7.02c.585 0 1.065-.48 1.065-1.065 0-2.34-1.89-4.23-4.23-4.23-.69 0-1.35.165-1.935.465-.36-1.29-1.53-2.235-2.925-2.235l-.545.755z",
  youtube: "M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z",
};

const availablePlatforms = Object.entries(project.links).filter(([_, url]) => url);
---

<div class={`animate-on-scroll ${staggerClass} card-glow group relative overflow-hidden rounded-3xl border border-zinc-200 bg-white p-6 shadow-sm transition hover:-translate-y-0.5 hover:border-zinc-300 hover:shadow-md`}>
  {project.cover && (
    <div class="mb-4 overflow-hidden rounded-2xl">
      <img
        src={project.cover}
        alt={project.name}
        class="aspect-video w-full object-cover transition group-hover:scale-105"
        loading="lazy"
      />
    </div>
  )}

  <div class="flex items-start justify-between gap-4">
    <div>
      <div class="flex flex-wrap items-center gap-2 text-xs text-zinc-500">
        <span class="rounded-full border border-zinc-200 bg-zinc-50 px-2.5 py-0.5">{project.genre}</span>
        {project.years && <span>{project.years}</span>}
        {project.city && <span>Â· {project.city}</span>}
      </div>
      <h3 class="mt-3 text-lg font-semibold tracking-tight">{project.name}</h3>
      {project.role && (
        <p class="mt-1 text-xs text-zinc-500">{project.role}</p>
      )}
      <p class="mt-2 text-sm text-zinc-600">{pick(project.description, locale)}</p>
    </div>
  </div>

  {availablePlatforms.length > 0 && (
    <div class="mt-5 flex flex-wrap gap-2">
      {availablePlatforms.map(([platform, url]) => (
        <a
          href={url}
          target="_blank"
          rel="noreferrer"
          class="inline-flex items-center gap-1.5 rounded-full border border-zinc-200 bg-white px-3 py-1.5 text-xs font-medium text-zinc-700 transition hover:border-zinc-300 hover:bg-zinc-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]"
          title={platform.charAt(0).toUpperCase() + platform.slice(1)}
        >
          <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor">
            <path d={platformIcons[platform] || ""} />
          </svg>
          <span class="capitalize">{platform === "appleMusic" ? "Apple" : platform}</span>
        </a>
      ))}
    </div>
  )}
</div>
