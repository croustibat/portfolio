---
import { ViewTransitions } from "astro:transitions";
import "../styles/global.css";

const {
  title = "Baptiste Bouillot — Portfolio",
  description = "Product Engineer / CTO — open-source & macOS experiments.",
  ogType = "website",
  ogImage,
  locale,
} = Astro.props;

const pathname = Astro.url.pathname;
const strippedPath = pathname.replace(/^\/(fr|en)(?=\/|$)/, "");
const currentLocale = locale ?? (pathname.startsWith("/en") ? "en" : "fr");
const basePath = currentLocale === "fr" ? "/fr" : "/en";
const frPath = `/fr${strippedPath || ""}`;
const enPath = `/en${strippedPath || ""}`;
const canonicalPath = currentLocale === "fr" ? frPath : enPath;

const canonicalUrl = Astro.site ? new URL(canonicalPath, Astro.site).toString() : null;
const frUrl = Astro.site ? new URL(frPath, Astro.site).toString() : null;
const enUrl = Astro.site ? new URL(enPath, Astro.site).toString() : null;
const ogImageUrl = Astro.site
  ? new URL(ogImage ?? "/images/og-default.svg", Astro.site).toString()
  : ogImage ?? "/images/og-default.svg";

const nav =
  currentLocale === "fr"
    ? {
        work: "Projets",
        oss: "Open source",
        music: "Musique",
        contact: "Contact",
        download: "Télécharger PDF",
        switchLabel: "EN",
        switchAria: "Switch to English",
      }
    : {
        work: "Work",
        oss: "Open-source",
        music: "Music",
        contact: "Contact",
        download: "Download PDF",
        switchLabel: "FR",
        switchAria: "Basculer en français",
      };

const switchHref = currentLocale === "fr" ? enPath : frPath;
---

<!doctype html>
<html lang={currentLocale} class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>
    <meta name="theme-color" content="#7C3AED" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    {canonicalUrl ? <meta property="og:url" content={canonicalUrl} /> : null}
    {ogImageUrl ? <meta property="og:image" content={ogImageUrl} /> : null}
    <meta name="twitter:card" content={ogImageUrl ? "summary_large_image" : "summary"} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {ogImageUrl ? <meta name="twitter:image" content={ogImageUrl} /> : null}
    {canonicalUrl ? <link rel="canonical" href={canonicalUrl} /> : null}
    {frUrl ? <link rel="alternate" hreflang="fr" href={frUrl} /> : null}
    {enUrl ? <link rel="alternate" hreflang="en" href={enUrl} /> : null}
    {frUrl ? <link rel="alternate" hreflang="x-default" href={frUrl} /> : null}

    <!-- Umami Analytics -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="4fecb2b3-7f38-4085-b1be-add02d3d971d"></script>

    <!-- View Transitions -->
    <ViewTransitions />
  </head>

  <body class="bg-zinc-50 text-zinc-900">
    {/* Creative layered background */}
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      {/* Dot grid pattern */}
      <div class="absolute inset-0 opacity-[0.04] [background-image:radial-gradient(#000_1px,transparent_1px)] [background-size:24px_24px]"></div>
      {/* Gradient orbs */}
      <div class="absolute -left-1/4 top-0 h-[600px] w-[600px] rounded-full bg-gradient-to-br from-[rgb(var(--accent)/0.08)] to-transparent blur-3xl"></div>
      <div class="absolute -right-1/4 top-1/3 h-[500px] w-[500px] rounded-full bg-gradient-to-bl from-[rgb(var(--accent-secondary)/0.06)] to-transparent blur-3xl"></div>
      <div class="absolute bottom-0 left-1/3 h-[400px] w-[400px] rounded-full bg-gradient-to-t from-[rgb(var(--accent-tertiary)/0.05)] to-transparent blur-3xl"></div>
    </div>

    <header class="relative mx-auto max-w-6xl px-6 py-8">
      <nav class="flex items-center justify-between">
        <a href="/" class="group text-lg font-bold tracking-tight transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-4 focus-visible:outline-[rgb(var(--accent))]">
          <span class="bg-gradient-to-r from-zinc-900 via-zinc-900 to-zinc-900 bg-clip-text transition-all group-hover:from-[rgb(var(--accent))] group-hover:via-[rgb(var(--accent-secondary))] group-hover:to-[rgb(var(--accent-tertiary))] group-hover:text-transparent">baptiste</span><span class="text-zinc-400">.ultraviolettes</span>
        </a>

        <div class="flex items-center gap-1 text-sm">
          <a href={`${basePath}#work`} class="rounded-lg px-3 py-2 text-zinc-600 transition hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]">{nav.work}</a>
          <a href={`${basePath}#oss`} class="rounded-lg px-3 py-2 text-zinc-600 transition hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]">{nav.oss}</a>
          <a href={`${basePath}/music`} class="rounded-lg px-3 py-2 text-zinc-600 transition hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]">{nav.music}</a>
          <a href={`${basePath}#contact`} class="rounded-lg px-3 py-2 text-zinc-600 transition hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]">{nav.contact}</a>
          <div class="mx-2 h-4 w-px bg-zinc-200"></div>
          <a
            href={switchHref}
            class="rounded-lg px-3 py-2 text-xs font-medium text-zinc-500 transition hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]"
            aria-label={nav.switchAria}
          >
            {nav.switchLabel}
          </a>
          <a href="/pdf/baptiste-bouillot-portfolio.pdf"
             class="ml-2 rounded-full bg-zinc-900 px-4 py-2 text-xs font-medium text-white transition hover:bg-zinc-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[rgb(var(--accent))]">
            {nav.download}
          </a>
        </div>
      </nav>
    </header>

    <main class="relative mx-auto max-w-6xl px-6">
      <slot />
    </main>

    <footer class="relative mx-auto max-w-6xl px-6 pb-12 pt-8 text-sm">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <p class="text-zinc-500">© {new Date().getFullYear()} Baptiste Bouillot</p>
        <p class="flex items-center gap-2 text-zinc-400">
          <span class="h-1.5 w-1.5 rounded-full bg-gradient-to-r from-[rgb(var(--accent))] to-[rgb(var(--accent-secondary))]"></span>
          Built with Astro + Tailwind
        </p>
      </div>
    </footer>

    <script>
      // Scroll animations with Intersection Observer
      const initScrollAnimations = () => {
        const animatedElements = document.querySelectorAll(
          '.animate-on-scroll, .animate-fade, .animate-slide-left, .animate-slide-right, .animate-scale'
        );

        if (!animatedElements.length) return;

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                // Optionally unobserve after animation (better performance)
                observer.unobserve(entry.target);
              }
            });
          },
          {
            threshold: 0.1, // Trigger when 10% visible
            rootMargin: '0px 0px -50px 0px' // Trigger slightly before fully in view
          }
        );

        animatedElements.forEach((el) => observer.observe(el));
      };

      // Run on initial load
      initScrollAnimations();

      // Re-run after Astro page transitions (View Transitions API)
      document.addEventListener('astro:page-load', initScrollAnimations);

      // Spotlight effect - glow follows cursor on cards
      const initSpotlightEffect = () => {
        const cards = document.querySelectorAll('.spotlight-card');

        cards.forEach((card) => {
          const spotlight = card.querySelector('.spotlight-gradient') as HTMLElement;
          if (!spotlight) return;

          card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = (e as MouseEvent).clientX - rect.left;
            const y = (e as MouseEvent).clientY - rect.top;

            spotlight.style.left = `${x}px`;
            spotlight.style.top = `${y}px`;
          });

          card.addEventListener('mouseleave', () => {
            // Reset position when mouse leaves
            spotlight.style.left = '50%';
            spotlight.style.top = '50%';
          });
        });
      };

      // Run on initial load
      initSpotlightEffect();

      // Re-run after Astro page transitions
      document.addEventListener('astro:page-load', initSpotlightEffect);
    </script>
  </body>
</html>
